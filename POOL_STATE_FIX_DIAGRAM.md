# Pool State 및 관리자 지갑 통일 해결 방안 다이어그램

## 문제 상황 (Before)

```
+---------------------+       +---------------------+
| 환경 변수           |       | 온체인 Pool State   |
|                     |       |                     |
| ADMIN_WALLET:       |       | admin:              |
| qNfZ9QHYyu5...BZi3  | ≠     | 8h2QEZyi79KcY...Gvi |
+---------------------+       +---------------------+
         ↓                             ↓
+---------------------+       +---------------------+
| 스테이킹 클라이언트 |       | 온체인 프로그램     |
| - 환경 변수 사용    |       | - Pool State 사용   |
| - 권한 검증 실패    |  ✗    | - 트랜잭션 실패     |
+---------------------+       +---------------------+
```

## 해결 방안 (After)

```
+----------------------------------------+
| 1. 강제 풀 초기화                     |
|                                        |
| initialize-pool 페이지에서             |
| qNfZ9QHYyu5...BZi3 지갑으로 연결하여   |
| 새로운 Pool State를 강제로 초기화      |
+----------------------------------------+
                   ↓
+----------------------------------------+
| 2. 환경 변수 업데이트                  |
|                                        |
| POOL_STATE_ADDRESS=<새_풀_주소>        |
+----------------------------------------+
                   ↓
+---------------------+       +---------------------+
| 환경 변수 (통일됨)  |       | 새 온체인 Pool State|
|                     |       |                     |
| ADMIN_WALLET:       |       | admin:              |
| qNfZ9QHYyu5...BZi3  | ===   | qNfZ9QHYyu5...BZi3  |
|                     |       |                     |
| POOL_STATE_ADDRESS: |       |                     |
| <새_풀_주소>        | ===   | <새_풀_주소>        |
+---------------------+       +---------------------+
         ↓                             ↓
+---------------------+       +---------------------+
| 스테이킹 클라이언트 |       | 온체인 프로그램     |
| - 환경 변수 사용    |       | - Pool State 사용   |
| - 권한 검증 성공    |  ✓    | - 트랜잭션 성공     |
+---------------------+       +---------------------+
```

## 코드 변경 흐름

```
prepareStaking_v3.js  ←─────┐
prepareUnstaking_v3.js  ←───┤
                           │
                           │ POOL_STATE_ADDRESS
                           │ 환경 변수 사용
                           │
.env.local  ───────────────┘
(POOL_STATE_ADDRESS=<새_풀_주소>)
(NEXT_PUBLIC_ADMIN_WALLET_ADDRESSES=qNfZ9QHYyu5...BZi3)
```

## 구현 변경 요약

1. **환경 변수에서 풀 주소 읽기**
   - API 요청 시 하드코딩된 주소 대신 환경 변수 사용
   - 없으면 기본값으로 폴백 (이전 버전 호환성 유지)

2. **강제 초기화 옵션**
   - 기존 풀이 있어도 새 풀 초기화 가능
   - 새 풀의 관리자는 환경 변수에서 지정한 지갑으로 설정

3. **관리자 일치 확인**
   - Pool State 관리자와 환경 변수 관리자 일치 여부 표시
   - 불일치 시 시각적 경고 제공

4. **쉬운 환경 변수 설정**
   - 코드 변경 없이 .env.local 파일에 환경 변수만 추가
   - 서버 재시작만으로 모든 변경사항 적용