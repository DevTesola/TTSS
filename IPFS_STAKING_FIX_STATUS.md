# IPFS 및 스테이킹 수정 현황

## 1. IPFS 이미지 로딩 수정 완료

IPFS 이미지 로딩 문제가 해결되었습니다:
- 게이트웨이 URL 형식 일관성 확보 (`/ipfs/`)
- 스테이킹 컴포넌트 감지 로직 중앙화
- 캐시 시간 최적화 (스테이킹 컴포넌트: 30분, 일반: 24시간)
- 캐시 버스팅 주기 개선 (시간 단위로 변경)

## 2. 스테이킹 온체인 시스템 업데이트 완료

스테이킹 시스템 업데이트가 완료되었습니다:
- 사용자당 최대 NFT 수를 1개에서 3개로 확장
- 시간 기반 배율 추가 (30일 기간, 5% 증가, 최대 50% 보너스)
- 중간 긴급 언스테이킹 기능 추가 (5% 수수료 적용)
- 풀 초기화 및 설정 기능 구현

## 3. 현재 확인된 이슈

테스트 환경에서 다음 이슈가 발견되었습니다:

1. **계정 구조 호환성 문제**:
   ```
   Error parsing UserStakingInfo: Error: Invalid UserStakingInfo data: discriminator mismatch
   ```
   - 원인: 계정 구조 업데이트 후 클라이언트 코드 미동기화
   - 해결방안: IDL 갱신 및 계정 파싱 로직 업데이트 필요

2. **스테이킹 트랜잭션 오류**:
   ```
   AccountNotInitialized. Error Number: 3012
   ```
   - 원인: 모의 데이터와 실제 온체인 계정 간 불일치
   - 해결방안: 모의 데이터 모드일 때 트랜잭션 검증 생략 필요

3. **이미지 로딩 간헐적 문제**:
   - 원인: 로딩 상태 전환이 빈번함
   - 해결방안: 캐시 시간 증가 및 캐시 버스팅 주기 변경 (구현됨)

## 4. 즉시 테스트 가능한 기능

1. **IPFS 이미지 로딩 개선** - 테스트 방법:
   - 개발 서버 실행: `npm run dev`
   - 스테이킹 페이지(`/staking`) 방문
   - 이미지 로딩 속도와 안정성 확인
   - 브라우저 콘솔에서 이미지 요청 URL 확인 (캐시 버스팅 적용됨)

2. **스테이킹 UI** - 테스트 방법:
   - 스테이킹 대시보드 방문
   - 스테이킹 NFT 카드 확인 (모의 데이터 생성됨)
   - 카드 확장 및 상세 정보 확인

3. **개선된 캐싱** - 테스트 방법:
   - 브라우저 개발자 도구에서 네트워크 탭 열기
   - 이미지 요청 모니터링
   - 캐시 처리된 요청 및 신규 요청 비율 확인

## 5. 남은 작업

1. **IDL 업데이트**:
   - 계정 구조 변경사항 반영
   - 새로운 필드 및 명령어 추가

2. **모의 데이터 모드 개선**:
   - 개발 환경에서 실제 트랜잭션 전송 스킵
   - 모의 데이터 구조 실제 계정과 일치시키기

3. **테스트 배포**:
   - devnet에 최신 버전 배포
   - 실제 NFT로 전체 워크플로우 테스트
   - 토큰 전송 기능 검증

## 6. 결론

IPFS 이미지 로딩 및 스테이킹 시스템 주요 기능 구현이 완료되었습니다. 현재는 테스트 환경의 데이터 불일치로 인한 오류가 발생하고 있으며, 이는 IDL 업데이트와 모의 데이터 모드 개선으로 해결 가능합니다.

다음 단계는 IDL 업데이트와 모의 데이터 모드 개선에 초점을 맞추어 진행할 예정입니다.